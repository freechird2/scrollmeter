{"version":3,"file":"index.mjs","sources":["../src/types/scrollmeter.types.ts","../src/class/scrollmeter-tooltip.ts","../src/class/scrollmeter-timeline.ts","../src/class/scrollmeter.ts","../src/index.ts"],"sourcesContent":["export interface ScrollmeterTimelineOptions {\n  color?: string\n  width?: number\n}\n\nexport interface ScrollmeterBarOptions {\n  color?: string\n  background?: string\n  height?: number\n}\n\nexport interface ScrollmeterTooltipOptions {\n  background?: string\n  fontColor?: string\n  fontSize?: number\n  paddingBlock?: number\n  paddingInline?: number\n  width?: number\n}\n\nexport interface ScrollmeterOptions {\n  targetId: string\n  useTimeline?: boolean\n  useTooltip?: boolean\n  usePreview?: boolean\n  barOptions?: ScrollmeterBarOptions\n  timelineOptions?: ScrollmeterTimelineOptions\n  tooltipOptions?: ScrollmeterTooltipOptions\n}\n\nexport abstract class IScrollmeter {\n  protected abstract setCSSCustomProperties(): void\n}\n","import { IScrollmeter } from '../types/scrollmeter.types'\nimport { Scrollmeter } from './scrollmeter'\nimport styles from '../styles/scrollmeter.module.scss'\n\nexport class ScrollmeterTooltip extends IScrollmeter {\n    #scrollmeter: Scrollmeter\n\n    constructor(scrollmeter: Scrollmeter) {\n        super()\n        this.#scrollmeter = scrollmeter\n    }\n\n    #cropImageAtPercent = (targetElement: HTMLElement, cropWidth: number = 320) => {\n        const captureCanvas = this.#scrollmeter.getCaptureCanvas()\n        if (!captureCanvas) return\n\n        const canvasWidth = captureCanvas.width\n        const canvasHeight = (canvasWidth * 9) / 16 // 16:9 비율 계산\n        const y = Math.max(0, targetElement.getBoundingClientRect().top + window.scrollY - canvasHeight / 2)\n\n        const cropHeight = (cropWidth * 9) / 16 // 16:9 비율 계산\n\n        const tempCanvas = document.createElement('canvas')\n        tempCanvas.width = cropWidth\n        tempCanvas.height = cropHeight\n\n        const ctx = tempCanvas.getContext('2d')\n        if (!ctx) return null\n\n        // 크롭된 영역 그리기\n        ctx.drawImage(\n            captureCanvas,\n            0,\n            Math.max(0, Math.min(y, captureCanvas.height - canvasHeight)), // y값 범위 제한\n            canvasWidth,\n            canvasHeight,\n            0,\n            0,\n            cropWidth,\n            cropHeight\n        )\n\n        return tempCanvas.toDataURL()\n    }\n\n    #createPreview = (dataUrl: string) => {\n        const div = document.createElement('div')\n        div.classList.add(styles.scrollmeter_timeline_preview)\n\n        const img = new Image()\n\n        img.src = dataUrl\n\n        div.appendChild(img)\n        return div\n    }\n\n    public createTimelineTooltip = (\n        timelineElement: HTMLDivElement,\n        targetElement: HTMLElement,\n        direction: 'left' | 'right' | 'center'\n    ) => {\n        if (!targetElement.textContent) return\n        const timelineTooltip = document.createElement('div')\n        const timelineTooltipText = document.createElement('p')\n\n        if (this.#scrollmeter.getDefaultOptions().usePreview) {\n            const dataUrl = this.#cropImageAtPercent(targetElement)\n\n            if (dataUrl) {\n                const preview = this.#createPreview(dataUrl)\n                timelineTooltip.appendChild(preview)\n            }\n        }\n\n        timelineTooltip.classList.add(styles.scrollmeter_timeline_tooltip)\n        timelineTooltip.classList.add(styles[`scrollmeter_timeline_tooltip_${direction}`])\n\n        timelineTooltipText.textContent = targetElement.textContent\n\n        timelineTooltip.appendChild(timelineTooltipText)\n\n        this.setCSSCustomProperties()\n\n        timelineElement.appendChild(timelineTooltip)\n    }\n\n    protected setCSSCustomProperties() {\n        const defaultOptions = this.#scrollmeter.getDefaultOptions()\n\n        // css custom\n        if (defaultOptions && defaultOptions.tooltipOptions) {\n            const { background, fontColor, fontSize, paddingBlock, paddingInline, width } = defaultOptions.tooltipOptions\n\n            if (background) {\n                this.#scrollmeter.getScrollmeterContainer()?.style.setProperty('--scrollmeter-tooltip-background', background)\n            }\n            if (fontColor) {\n                this.#scrollmeter.getScrollmeterContainer()?.style.setProperty('--scrollmeter-tooltip-font-color', fontColor)\n            }\n            if (fontSize) {\n                this.#scrollmeter.getScrollmeterContainer()?.style.setProperty('--scrollmeter-tooltip-font-size', `${fontSize}px`)\n            }\n            if (paddingBlock) {\n                this.#scrollmeter.getScrollmeterContainer()?.style.setProperty('--scrollmeter-tooltip-padding-block', `${paddingBlock}px`)\n            }\n            if (paddingInline) {\n                this.#scrollmeter.getScrollmeterContainer()?.style.setProperty('--scrollmeter-tooltip-padding-inline', `${paddingInline}px`)\n            }\n            if (width) {\n                this.#scrollmeter.getScrollmeterContainer()?.style.setProperty('--scrollmeter-tooltip-width', `${width}px`)\n            }\n        }\n    }\n}\n","import styles from '../styles/scrollmeter.module.scss'\nimport { IScrollmeter } from '../types/scrollmeter.types'\nimport { Scrollmeter } from './scrollmeter'\nimport { ScrollmeterTooltip } from './scrollmeter-tooltip'\n\nexport class ScrollmeterTimeline extends IScrollmeter {\n    #scrollmeter: Scrollmeter\n\n    constructor(scrollmeter: Scrollmeter) {\n        super()\n        this.#scrollmeter = scrollmeter\n    }\n\n    #findTimelineElements = (element: HTMLElement): HTMLElement[] => {\n        const elArray: HTMLElement[] = []\n\n        const searchH1 = (el: HTMLElement) => {\n            if (el.tagName.toLowerCase() === 'h1') {\n                if (this.#isElementVisible(el)) {\n                    elArray.push(el as HTMLHeadingElement)\n                }\n            }\n\n            Array.from(el.children).forEach((child) => {\n                searchH1(child as HTMLElement)\n            })\n        }\n\n        searchH1(element)\n\n        return elArray\n    }\n\n    #isElementVisible(element: HTMLElement): boolean {\n        // 요소 자체나 부모 요소들의 style 체크\n        const style = window.getComputedStyle(element)\n        if (style.display === 'none') return false\n        if (style.visibility === 'hidden') return false\n        if (style.opacity === '0') return false\n\n        // 부모 요소들도 순차적으로 확인\n        let currentElement: HTMLElement | null = element.parentElement\n        while (currentElement) {\n            const parentStyle = window.getComputedStyle(currentElement)\n            if (parentStyle.display === 'none') return false\n            if (parentStyle.visibility === 'hidden') return false\n            if (parentStyle.opacity === '0') return false\n            currentElement = currentElement.parentElement\n        }\n\n        return true\n    }\n\n    public createTimeline = (highestZIndex: number): ScrollmeterTimeline => {\n        const targetContainer = this.#scrollmeter.getTargetContainer()\n        if (!targetContainer) return null\n\n        const targetElement = this.#findTimelineElements(targetContainer)\n\n        if (targetElement.length === 0) return null\n\n        const timelineElements: HTMLElement[] = []\n        const timelineWidth = this.#scrollmeter.getDefaultOptions().timelineOptions?.width ?? 4\n        let outOfBoundIndex = targetElement.length\n\n        targetElement.map((element) => {\n            const scrollContainer = this.#scrollmeter.getTargetContainer()\n\n            if (!scrollContainer) return\n\n            const timelineElement = document.createElement('div')\n            timelineElement.classList.add(styles.scrollmeter_timeline)\n\n            const absoluteElementTop = element.getBoundingClientRect().top + window.scrollY\n            const absoluteContainerTop = scrollContainer.getBoundingClientRect().top + window.scrollY\n            const relativeTargetTop = absoluteElementTop - absoluteContainerTop\n            const scrollableHeight = scrollContainer.clientHeight - document.documentElement.clientHeight\n\n            timelineElement.style.zIndex = highestZIndex.toString()\n\n            timelineElement.addEventListener('click', () => {\n                element.scrollIntoView({ behavior: 'smooth' })\n            })\n\n            if (scrollableHeight > absoluteElementTop) {\n                const relativePosition = (relativeTargetTop / scrollableHeight) * 100\n\n                timelineElement.style.left = `${relativePosition > 100 ? `calc(100% - ${timelineWidth}px)` : `${relativePosition}%`}`\n\n                if (this.#scrollmeter.getDefaultOptions().useTooltip) {\n                    const tooltip = new ScrollmeterTooltip(this.#scrollmeter)\n\n                    tooltip.createTimelineTooltip(timelineElement, element, relativePosition < 7.6 ? 'left' : 'center')\n                }\n            } else {\n                timelineElement.style.left = `calc(100% - ${timelineWidth * (outOfBoundIndex-- * 4)}px)`\n\n                if (this.#scrollmeter.getDefaultOptions().useTooltip) {\n                    const tooltip = new ScrollmeterTooltip(this.#scrollmeter)\n\n                    tooltip.createTimelineTooltip(timelineElement, element, 'right')\n                }\n            }\n\n            this.#scrollmeter.getScrollmeterContainer()?.appendChild(timelineElement)\n            timelineElements.push(timelineElement)\n        })\n\n        this.setCSSCustomProperties()\n\n        return this\n    }\n\n    public setCSSCustomProperties() {\n        const defaultOptions = this.#scrollmeter.getDefaultOptions()\n        // css custom\n        if (defaultOptions && defaultOptions.timelineOptions) {\n            const { color, width } = defaultOptions.timelineOptions\n\n            if (color) {\n                this.#scrollmeter.getScrollmeterContainer()?.style.setProperty('--scrollmeter-timeline-color', color)\n            }\n            if (width) {\n                this.#scrollmeter.getScrollmeterContainer()?.style.setProperty('--scrollmeter-timeline-width', `${width}px`)\n            }\n        }\n    }\n}\n","import html2canvas from 'html2canvas'\nimport styles from '../styles/scrollmeter.module.scss'\nimport { IScrollmeter, ScrollmeterOptions } from '../types/scrollmeter.types'\nimport { ScrollmeterTimeline } from './scrollmeter-timeline'\n\nexport class Scrollmeter extends IScrollmeter {\n    #defaultOptions: ScrollmeterOptions\n    #targetContainer: HTMLElement | null\n    #scrollmeterContainer: HTMLDivElement | null\n    #scrollmeterBar: HTMLDivElement | null\n    #resizeObserver: ResizeObserver | null\n\n    #timelineElements: ScrollmeterTimeline | null\n\n    #captureCanvas: HTMLCanvasElement | null\n\n    #containerHeight: number\n    #barWidth: number\n    #totalHeight: number\n    #elementTop: number\n    #highestZIndex: number\n\n    constructor(options: ScrollmeterOptions) {\n        super()\n        const { targetId } = options\n        this.#defaultOptions = options\n\n        this.#targetContainer = document.getElementById(targetId) ?? null\n        this.#scrollmeterContainer = null\n        this.#scrollmeterBar = null\n        this.#resizeObserver = null\n        this.#captureCanvas = null\n        this.#timelineElements = null\n\n        // 숫자 필드 초기화\n        this.#containerHeight = 0\n        this.#barWidth = 0\n        this.#totalHeight = 0\n        this.#elementTop = 0\n        this.#highestZIndex = 0\n\n        this.#initResizeObserver()\n\n        this.#createScrollmeter()\n    }\n\n    #initResizeObserver = () => {\n        if (!this.#targetContainer) {\n            throw new Error('targetContainer is not found')\n        }\n\n        this.#resizeObserver = new ResizeObserver(async (entries) => {\n            if (!this.#targetContainer) return\n\n            if (!this.#scrollmeterContainer || this.#containerHeight === entries[0].contentRect.height) return\n\n            this.#containerHeight = entries[0].contentRect.height\n\n            const marginTop = parseInt(window.getComputedStyle(this.#targetContainer).marginTop)\n            const marginBottom = parseInt(window.getComputedStyle(this.#targetContainer).marginBottom)\n            this.#elementTop = window.scrollY + this.#targetContainer.getBoundingClientRect().top\n            this.#totalHeight = this.#targetContainer.clientHeight + marginTop + marginBottom - document.documentElement.clientHeight\n\n            this.#updateBarWidth()\n\n            if (this.#defaultOptions.useTimeline) {\n                document.querySelectorAll(`.${styles.scrollmeter_timeline}`).forEach((element) => {\n                    element.remove()\n                })\n\n                if (this.#defaultOptions.usePreview) {\n                    await this.#captureContainer()\n                }\n\n                const timeline = new ScrollmeterTimeline(this)\n\n                this.#timelineElements = timeline.createTimeline(this.#highestZIndex)\n            }\n        })\n    }\n\n    #createScrollmeterContainer = () => {\n        try {\n            if (!this.#targetContainer) throw new Error('targetContainer is not found')\n\n            const scrollmeterContainer = document.createElement('div') as HTMLDivElement\n            scrollmeterContainer.classList.add(styles.scrollmeter_container)\n\n            const highestZIndex = this.#findHighestZIndex(this.#targetContainer)\n            this.#highestZIndex = highestZIndex\n            scrollmeterContainer.style.zIndex = highestZIndex.toString()\n\n            const scrollmeterBar = this.#createScrollmeterBar()\n            scrollmeterContainer.appendChild(scrollmeterBar)\n\n            this.#scrollmeterContainer = scrollmeterContainer\n\n            this.setCSSCustomProperties()\n\n            return scrollmeterContainer\n        } catch (error) {\n            console.error(error)\n        }\n    }\n\n    #createScrollmeterBar = () => {\n        const scrollmeterBar = document.createElement('div')\n        scrollmeterBar.classList.add(styles.scrollmeter_bar)\n\n        this.#scrollmeterBar = scrollmeterBar\n\n        return scrollmeterBar\n    }\n\n    #findHighestZIndex = (element: HTMLElement) => {\n        let highest = 0\n\n        const zIndex = window.getComputedStyle(element).zIndex\n\n        if (zIndex !== 'auto') {\n            highest = Math.max(highest, parseInt(zIndex))\n        }\n\n        Array.from(element.children).forEach((child) => {\n            highest = Math.max(highest, this.#findHighestZIndex(child as HTMLElement))\n        })\n\n        return highest + 1\n    }\n\n    #updateBarWidth = () => {\n        if (!this.#targetContainer) return\n        const isVisibleScrollmeter = this.#isVisibleScrollmeter()\n\n        if (!isVisibleScrollmeter) {\n            this.#scrollmeterContainer!.style.opacity = '0'\n            return\n        }\n\n        this.#scrollmeterContainer!.style.opacity = '1'\n\n        const currentScroll = window.scrollY - this.#elementTop\n        const scrollPercentage = (currentScroll / this.#totalHeight) * 100\n\n        this.#barWidth = Math.min(100, Math.max(0, scrollPercentage))\n\n        if (this.#scrollmeterBar) {\n            this.#scrollmeterBar.style.width = `${this.#barWidth}%`\n        }\n    }\n\n    #isVisibleScrollmeter = () => {\n        if (!this.#targetContainer) return false\n\n        return this.#targetContainer.getBoundingClientRect().top <= 0 && this.#targetContainer.getBoundingClientRect().bottom > 0\n    }\n\n    #captureContainer = async () => {\n        if (!this.#targetContainer) return\n\n        try {\n            const canvas = await html2canvas(document.documentElement, {\n                ignoreElements: (element) => {\n                    const ignoreClasses = [styles.scrollmeter_container]\n                    return ignoreClasses.some((className) => element.classList.contains(className))\n                },\n            })\n\n            this.#captureCanvas = canvas\n        } catch (error) {\n            console.error('미리보기를 생성하는 중 오류가 발생했습니다:', error)\n        }\n    }\n\n    #createScrollmeter = () => {\n        try {\n            if (!this.#targetContainer) throw new Error('targetContainer is not found')\n\n            const existingScrollmeter = document.querySelectorAll(`.${styles.scrollmeter_container}`)\n\n            if (existingScrollmeter.length > 0) {\n                return null\n            }\n\n            if (!this.#resizeObserver) {\n                throw new Error('resizeObserver is not found')\n            }\n\n            const container = this.#createScrollmeterContainer()\n\n            if (!container) throw new Error('scrollmetercontainer is not found')\n\n            this.#targetContainer.appendChild(container)\n\n            this.#resizeObserver.observe(this.#targetContainer)\n\n            window.addEventListener('scroll', this.#updateBarWidth)\n        } catch (error) {\n            console.error(error)\n        }\n    }\n\n    protected setCSSCustomProperties = () => {\n        if (!this.#scrollmeterContainer) return\n        // css custom\n        if (this.#defaultOptions.barOptions) {\n            const { color, background, height } = this.#defaultOptions.barOptions\n            if (color) {\n                this.#scrollmeterContainer.style.setProperty('--scrollmeter-bar-color', color)\n            }\n            if (background) {\n                this.#scrollmeterContainer.style.setProperty('--scrollmeter-bar-background', background)\n            }\n            if (height) {\n                this.#scrollmeterContainer.style.setProperty('--scrollmeter-bar-height', `${height}px`)\n            }\n        }\n    }\n\n    public getTargetContainer = () => {\n        return this.#targetContainer\n    }\n\n    public getScrollmeterContainer = () => {\n        return this.#scrollmeterContainer\n    }\n\n    public getCaptureCanvas = () => {\n        return this.#captureCanvas || null\n    }\n\n    public getDefaultOptions = () => {\n        return this.#defaultOptions\n    }\n\n    public updateScrollmeterStyle = (options: ScrollmeterOptions) => {\n        this.#defaultOptions = options\n\n        this.setCSSCustomProperties()\n\n        this.#timelineElements?.setCSSCustomProperties()\n\n        // css custom\n        if (this.#defaultOptions && this.#defaultOptions.tooltipOptions) {\n            const { background, fontColor, fontSize, paddingBlock, paddingInline, width } = this.#defaultOptions.tooltipOptions\n\n            if (background) {\n                this.#scrollmeterContainer.style.setProperty('--scrollmeter-tooltip-background', background)\n            }\n            if (fontColor) {\n                this.#scrollmeterContainer.style.setProperty('--scrollmeter-tooltip-font-color', fontColor)\n            }\n            if (fontSize) {\n                this.#scrollmeterContainer.style.setProperty('--scrollmeter-tooltip-font-size', `${fontSize}px`)\n            }\n            if (paddingBlock) {\n                this.#scrollmeterContainer.style.setProperty('--scrollmeter-tooltip-padding-block', `${paddingBlock}px`)\n            }\n            if (paddingInline) {\n                this.#scrollmeterContainer.style.setProperty('--scrollmeter-tooltip-padding-inline', `${paddingInline}px`)\n            }\n            if (width) {\n                this.#scrollmeterContainer.style.setProperty('--scrollmeter-tooltip-width', `${width}px`)\n            }\n        }\n    }\n}\n","import { Scrollmeter } from './class/scrollmeter'\nimport { ScrollmeterOptions } from './types/scrollmeter.types'\n\nexport const createScrollmeter = (options: ScrollmeterOptions): Scrollmeter | null => {\n    try {\n        return new Scrollmeter(options)\n    } catch (error) {\n        console.error(error)\n        return null\n    }\n}\n"],"names":["IScrollmeter","ScrollmeterTooltip","scrollmeter","__privateAdd","_scrollmeter","_cropImageAtPercent","_createPreview","__privateSet","targetElement","cropWidth","captureCanvas","__privateGet","canvasWidth","canvasHeight","y","cropHeight","tempCanvas","ctx","dataUrl","div","styles","img","timelineElement","direction","timelineTooltip","timelineTooltipText","preview","defaultOptions","background","fontColor","fontSize","paddingBlock","paddingInline","width","_a","_b","_c","_d","_e","_f","ScrollmeterTimeline","_ScrollmeterTimeline_instances","_findTimelineElements","element","elArray","searchH1","el","__privateMethod","isElementVisible_fn","child","highestZIndex","targetContainer","timelineWidth","outOfBoundIndex","scrollContainer","absoluteElementTop","absoluteContainerTop","relativeTargetTop","scrollableHeight","relativePosition","color","style","currentElement","parentStyle","Scrollmeter","options","_defaultOptions","_targetContainer","_scrollmeterContainer","_scrollmeterBar","_resizeObserver","_timelineElements","_captureCanvas","_containerHeight","_barWidth","_totalHeight","_elementTop","_highestZIndex","_initResizeObserver","_createScrollmeterContainer","_createScrollmeterBar","_findHighestZIndex","_updateBarWidth","_isVisibleScrollmeter","_captureContainer","_createScrollmeter","entries","marginTop","marginBottom","timeline","scrollmeterContainer","scrollmeterBar","error","highest","zIndex","scrollPercentage","canvas","html2canvas","className","container","height","targetId","createScrollmeter"],"mappings":"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"}